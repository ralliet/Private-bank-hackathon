var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler);},teardown:function(){$(this).off("resize",$special.handler);},handler:function(event,execAsap){var context=this,args=arguments,dispatch=function(){event.type="debouncedresize";$event.dispatch.apply(context,args);};if(resizeTimeout){clearTimeout(resizeTimeout);}
execAsap?dispatch():resizeTimeout=setTimeout(dispatch,$special.threshold);},threshold:250};var BLANK='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';$.fn.imagesLoaded=function(callback){var $this=this,deferred=$.isFunction($.Deferred)?$.Deferred():0,hasNotify=$.isFunction(deferred.notify),$images=$this.find('img').add($this.filter('img')),loaded=[],proper=[],broken=[];if($.isPlainObject(callback)){$.each(callback,function(key,value){if(key==='callback'){callback=value;}else if(deferred){deferred[key](value);}});}
function doneLoading(){var $proper=$(proper),$broken=$(broken);if(deferred){if(broken.length){deferred.reject($images,$proper,$broken);}else{deferred.resolve($images);}}
if($.isFunction(callback)){callback.call($this,$images,$proper,$broken);}}
function imgLoaded(img,isBroken){if(img.src===BLANK||$.inArray(img,loaded)!==-1){return;}
loaded.push(img);if(isBroken){broken.push(img);}else{proper.push(img);}
$.data(img,'imagesLoaded',{isBroken:isBroken,src:img.src});if(hasNotify){deferred.notifyWith($(img),[isBroken,$images,$(proper),$(broken)]);}
if($images.length===loaded.length){setTimeout(doneLoading);$images.unbind('.imagesLoaded');}}
if(!$images.length){doneLoading();}else{$images.bind('load.imagesLoaded error.imagesLoaded',function(event){imgLoaded(event.target,event.type==='error');}).each(function(i,el){var src=el.src;var cached=$.data(el,'imagesLoaded');if(cached&&cached.src===src){imgLoaded(el,cached.isBroken);return;}
if(el.complete&&el.naturalWidth!==undefined){imgLoaded(el,el.naturalWidth===0||el.naturalHeight===0);return;}
if(el.readyState||el.complete){el.src=BLANK;el.src=src;}});}
return deferred?deferred.promise($this):$this;};var PureGrid=(function(){var $grid=$('#og-grid'),$items=$grid.children('li'),current=-1,expanderPosition=0,transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd','msTransition':'MSTransitionEnd','transition':'transitionend'},transEndEventName=transEndEventNames[Modernizr.prefixed('transition')],support=Modernizr.csstransitions,$body=$('html, body'),settings={minHeight:500,speed:350,marginBottom:20,easing:'ease'};function init(config){settings=$.extend(true,{},settings,config);$grid.imagesLoaded(function(){saveItemInfo(true);initEvents();});}
function initEvents(){initItemsEvents($items);$(window).on('debouncedresize',function(){saveItemInfo(true);scrollExtra=0;previewPos=-1;$newheight=$('#og-grid li:first-child .dynamic-portfolio-holder').height();$items.each(function(){var $item=$(this);$item.stop().animate({'height':$newheight});});$expanded=$('#og-grid li.expanded');$expanded.removeClass('expanded').find('.og-expander').animate({opacity:'0'},500,function(){$expanded.find('.og-expander').css({height:0});});});}
function saveItemInfo(saveheight){$items.each(function(){var $item=$(this);var $expanded=$item.find('.og-expander');$item.data('offsetTop',$item.offset().top);if(saveheight){$item.data('height',$item.height());$expanded.css({'height':'auto'}).data('height',$expanded.height()).css({'height':0});}});}
function initItemsEvents($items){$items.on('click','span.og-close',function(){hidePreview();return false;}).children('a.grid-item-image').on('click',function(e){e.preventDefault();var $item=$(this).parent();if($item.hasClass('clickable')){if($item.hasClass('expanded')){}else{showPreview($item)}}
return false;});}
function showPreview($item){var $expanded=$item.find('.og-expander'),$image=$item.find('a.grid-item-image .dynamic-portfolio-holder'),$icon=$item.find('.loading-icon');offsetTop=$item.offset().top;current=$item.index();$item.addClass('loading');$icon.addClass('loading');totalheight=$expanded.data('height')+$image.height()+settings.marginBottom;if(offsetTop!==expanderPosition&&expanderPosition!==0){var $expandedItem=$('#og-grid li.expanded');$expandedItem.removeClass('expanded').find('.og-expander').animate({height:0,opacity:'0'},500,function(){$expandedItem.animate({'height':$expandedItem.data('height')},200);});$item.addClass('expanded').animate({height:totalheight},500,function(){$expanded.css({height:$expanded.data('height')}).animate({opacity:'1'},500,function(){expanderPosition=$('#og-grid li.expanded').offset().top;$body.animate({scrollTop:expanderPosition},settings.speed);$item.removeClass('loading').delay(800).find('.loading-icon').removeClass('loading');})})}else{var $expandedItem=$('#og-grid li.expanded');$item.addClass('expanded').animate({height:totalheight},500,function(){$expanded.css({height:$expanded.data('height')}).animate({opacity:'1'},200,function(){})
$expandedItem.animate({'height':$expandedItem.data('height')}).removeClass('expanded').find('.og-expander').css({height:0}).css({opacity:'0'})
expanderPosition=$('#og-grid li.expanded').offset().top;$body.animate({scrollTop:expanderPosition},settings.speed);$item.removeClass('loading').delay(800).find('.loading-icon').removeClass('loading');})}}
function setTransition($item){$item.find('.og-expander').css('transition','height '+settings.speed+'ms '+settings.easing);$item.css('transition','height '+settings.speed+'ms '+settings.easing);}
function hidePreview(){var $expandedItem=$items.eq(current);current=-1;$items.removeClass('expanded').find('.og-expander').animate({opacity:'0'},500,function(){$items.find('.og-expander').css({height:0});$items.animate({'height':$items.data('height')},200);});}
return{init:init};})();